---
title: 两相双极性步进电机驱动
date: 2018-04-06 16:37:00
tags: 
	- 嵌入式
	- 步进电机
	- C51
categories: 
	- 技术
	- 嵌入式
	- C51
---
## 前言
最近公司报废机器，所以我从要报废的机器中拆了不少零件，其中就在光驱中拆了迷你型步进电机（参见下图），在网上查阅资料了解到这个电机叫**两相双极性步进电机**。
{% asset_img steper.png %}
<!--more-->
## 驱动电机
有在网上了解到如何驱动**两相双极性步进电机**下面做一个简单的总结。
### 电机原理图
将电机简化成如下的原理图，1和2表示两个相位，即两组定子，双极性表示两个定子缠绕的线圈可以两个方向通电，并扭转定子的极性。
{% asset_img steper_schematic_static.png %}
### 转动原理
如果使用原理图简单表示90度(一次转动90°)两相双极性步进电机转动一圈的过程，1表示相1正向通电，1~表示相1反向通电，2和2~同理。
{% asset_img steper_run.png %}
1. 相1正向通电，相2断电，使得定子1上部为N极，下部为S极，异性相吸，转子会转动到第一张图的位置；
2. 相2正向通电，相1断电，使得定子2左部为S极，右部为N极，异性相吸，转子会转动到第二张图的位置；
3. 相1反向通电，相2断电，使得定子1上部为S极，下部为N极，异性相吸，转子会转动到第三张图的位置；
4. 相2反向通电，相1断电，使得定子2左部为N极，右部为S极，异性相吸，转子会转动到第二张图的位置。

### 电机仿真
上面介绍了两相双极性步进电机的工作原理，接下来，使用proteus来仿真Arduino来控制电机。
**元器件**:
    * Arduino 328
    * L298或ULN2004A驱动芯片
    * 两相双极性步进电机
**下面贴上proteus仿真过程中使用到的原理图**：
{% asset_img steper_schematic.gif %}
**最后贴上上图使用树莓派驱动电机的驱动代码**:
```c
/* Main.ino file generated by New Project wizard
 *
 * Created:   Thu Sep 5 2013
 * Processor: ATmega328P
 * Compiler:  Arduino AVR
 */

 #define LED ( 13 )
 #define MOTOR_PIN0 ( 0 )
 #define MOTOR_PIN1 ( 1 )
 #define MOTOR_PIN2 ( 2 )
 #define MOTOR_PIN3 ( 3 )
 #define MOTOR_PIN4 ( 4 )
 #define MOTOR_PIN5 ( 5 )
 #define MOTOR_PIN6 ( 6 )
 #define MOTOR_PIN7 ( 7 )
 #define MOTOR_ENA ( 8 )
 #define MOTOR_ENB ( 9 )
 
void setup()
 { // put your setup code here, to run once:
   pinMode( LED, OUTPUT );
   pinMode( MOTOR_PIN0, OUTPUT );
   pinMode( MOTOR_PIN1, OUTPUT );
   pinMode( MOTOR_PIN2, OUTPUT );
   pinMode( MOTOR_PIN3, OUTPUT );
   pinMode( MOTOR_PIN4, OUTPUT );
   pinMode( MOTOR_PIN5, OUTPUT );
   pinMode( MOTOR_PIN6, OUTPUT );
   pinMode( MOTOR_PIN7, OUTPUT );
   pinMode( MOTOR_ENA, OUTPUT );
   pinMode( MOTOR_ENB, OUTPUT );
 }

 void MotorOne()
 {
   static int i = 3;
   
   switch( i-- )
   {
      case 0:
     digitalWrite( MOTOR_PIN0, HIGH );
     digitalWrite( MOTOR_PIN1, LOW );
     digitalWrite( MOTOR_PIN2, LOW );
     digitalWrite( MOTOR_PIN3, LOW );
     break;
      case 1:
     digitalWrite( MOTOR_PIN0, LOW );
     digitalWrite( MOTOR_PIN1, HIGH );
     digitalWrite( MOTOR_PIN2, LOW );
     digitalWrite( MOTOR_PIN3, LOW );
     break;
      case 2:
     digitalWrite( MOTOR_PIN0, LOW );
     digitalWrite( MOTOR_PIN1, LOW );
     digitalWrite( MOTOR_PIN2, HIGH );
     digitalWrite( MOTOR_PIN3, LOW );
     break;
      case 3:
     digitalWrite( MOTOR_PIN0, LOW );
     digitalWrite( MOTOR_PIN1, LOW );
     digitalWrite( MOTOR_PIN2, LOW );
     digitalWrite( MOTOR_PIN3, HIGH );
     break;
      default:
     break;
   }
   
   if( 0 > i )
      i = 3;
 }
 
 void LedLight()
 {
   static int i = 0;
   if( 0 == i++ )
      digitalWrite( LED, HIGH );
   else
      digitalWrite( LED, LOW );
      
   if( 2 <= i )
      i = 0;
 }
 
 void MotorTwo()
 {
   static int i = 0;
   
   switch( i++ )
   {
      case 0:
     digitalWrite( MOTOR_PIN4, HIGH );
     digitalWrite( MOTOR_PIN5, LOW );
     digitalWrite( MOTOR_PIN6, LOW );
     digitalWrite( MOTOR_PIN7, LOW );
     break;
      case 1:
     digitalWrite( MOTOR_PIN4, LOW );
     digitalWrite( MOTOR_PIN5, HIGH );
     digitalWrite( MOTOR_PIN6, LOW );
     digitalWrite( MOTOR_PIN7, LOW );
     break;
      case 2:
     digitalWrite( MOTOR_PIN4, LOW );
     digitalWrite( MOTOR_PIN5, LOW );
     digitalWrite( MOTOR_PIN6, HIGH );
     digitalWrite( MOTOR_PIN7, LOW );
     break;
      case 3:
     digitalWrite( MOTOR_PIN4, LOW );
     digitalWrite( MOTOR_PIN5, LOW );
     digitalWrite( MOTOR_PIN6, LOW );
     digitalWrite( MOTOR_PIN7, HIGH );
     break;
      default:
     break;
   }
   
   if( 4 <= i )
      i = 0;
 }
 
void loop()
 { // put your main code here, to run repeatedly:
 
   MotorOne();
   LedLight();
   MotorTwo();
   
   delay(500);
   
 }
```